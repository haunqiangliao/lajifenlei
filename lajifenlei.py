import streamlit as st
from fuzzywuzzy import process

# å…¨é¢åƒåœ¾åˆ†ç±»æ•°æ®åº“ï¼ˆ2023æœ€æ–°ç‰ˆï¼‰
TRASH_CLASSIFICATION = {
    "å¯å›æ”¶ç‰©": [
        "æŠ¥çº¸", "ä¹¦æœ¬", "çº¸ç®±", "åŒ…è£…çº¸ç›’", "å¹¿å‘Šå•", "å¿«é€’çº¸ç®±", "æ‰“å°çº¸",
        "å¡‘æ–™ç“¶", "å¡‘æ–™ç©å…·", "å¡‘æ–™æ¡¶", "å¡‘æ–™è¡£æ¶", "å¡‘æ–™åŒ…è£…ç›’", "æ³¡æ²«å¡‘æ–™",
        "ç»ç’ƒç“¶", "ç»ç’ƒæ¯", "çª—æˆ·ç»ç’ƒ", "é•œå­", "é…’ç“¶",
        "é‡‘å±ç½", "é‡‘å±é¤å…·", "é‡‘å±æ–‡å…·", "é‡‘å±å¨å…·", "é‡‘å±å·¥å…·", "é’¥åŒ™",
        "æ—§è¡£æœ", "æ—§é‹å­", "æ—§åŒ…åŒ…", "åºŠå•", "çª—å¸˜", "æ¯›ç»’ç©å…·",
        "ç‰›å¥¶ç›’", "é¥®æ–™ç›’", "çº¸æ¯", "çº¸é¤ç›’"
    ],
    "æœ‰å®³åƒåœ¾": [
        "ç”µæ± ", "å……ç”µç”µæ± ", "çº½æ‰£ç”µæ± ", "è“„ç”µæ± ", "è§å…‰ç¯ç®¡", "èŠ‚èƒ½ç¯",
        "è¯å“", "è¯ç“¶", "è¯ç‰‡", "èƒ¶å›Š", "æ¸©åº¦è®¡", "è¡€å‹è®¡",
        "åŒ–å¦†å“", "æŒ‡ç”²æ²¹", "æŸ“å‘å‰‚", "æ¶ˆæ¯’å‰‚", "æ€è™«å‰‚", "è€é¼ è¯",
        "æ²¹æ¼†æ¡¶", "æ²¹æ¼†", "æ²¹æ¼†åˆ·", "æº¶å‰‚", "èƒ¶æ°´", "å¼ºåŠ›èƒ¶",
        "Xå…‰ç‰‡", "CTç‰‡", "ç›¸ç‰‡åº•ç‰‡", "åºŸèƒ¶ç‰‡"
    ],
    "æ¹¿åƒåœ¾": [
        "å‰©èœå‰©é¥­", "èœå¶", "æœçš®", "æœæ ¸", "æœå£³", "ç“œå­å£³",
        "èŒ¶å¶æ¸£", "å’–å•¡æ¸£", "ä¸­è¯æ¸£", "å® ç‰©é¥²æ–™", "é±¼éª¨å¤´", "è™¾å£³",
        "è›‹å£³", "é¢åŒ…", "é¥¼å¹²", "è›‹ç³•", "ç³–æœ", "åšæœ",
        "èŠ±å‰", "ç»¿æ¤", "è½å¶", "æ ‘æ", "ç›†æ ½", "èŠ±ç›†åœŸ",
        "è¿‡æœŸé£Ÿå“", "è…çƒ‚æ°´æœ", "å‘éœ‰é£Ÿç‰©", "å‰©é¥­", "å‰©é¢", "å‰©ç²¥"
    ],
    "å¹²åƒåœ¾": [
        "é¤å·¾çº¸", "å«ç”Ÿçº¸", "æ¹¿çº¸å·¾", "å°¿ä¸æ¹¿", "å«ç”Ÿå·¾", "çº¸å°¿è£¤",
        "å¡‘æ–™è¢‹", "é£Ÿå“åŒ…è£…è¢‹", "ä¿é²œè†œ", "ä¿é²œè¢‹", "å¿«é€’åŒ…è£…", "æ°”æ³¡è†œ",
        "ä¸€æ¬¡æ€§é¤å…·", "ä¸€æ¬¡æ€§æ¯å­", "ä¸€æ¬¡æ€§é¤ç›’", "ç‰™ç­¾", "å¸ç®¡", "ç­·å­",
        "çƒŸè’‚", "çƒŸç°", "æ‰“ç«æœº", "åˆ›å¯è´´", "æ£‰ç­¾", "åŒ–å¦†æ£‰",
        "ç¬”", "æ©¡çš®", "èƒ¶å¸¦", "æ©¡çš®æ³¥", "å¹²ç‡¥å‰‚", "é˜²æ½®å‰‚",
        "å¤§éª¨å¤´", "è´å£³", "ç¡¬æœå£³", "æ¯›å‘", "å® ç‰©ç²ªä¾¿", "çŒ«ç ‚",
        "è„æŠ¹å¸ƒ", "æ—§æ¯›å·¾", "ç ´ç¢—", "é™¶ç“·", "é›¨ä¼", "æ‰“ç«æœº",
        "å£ç½©", "æ‰‹å¥—", "è¢œå­", "å†…è¡£", "æ—§è¢œå­", "æ—§å†…è¡£"
    ]
}

# åˆ›å»ºæ‰€æœ‰åƒåœ¾åç§°çš„åˆ—è¡¨
ALL_ITEMS = []
for items in TRASH_CLASSIFICATION.values():
    ALL_ITEMS.extend(items)

# é¡µé¢è®¾ç½®
st.set_page_config(
    page_title="ä¸Šæµ·åƒåœ¾åˆ†ç±»å°åŠ©æ‰‹",
    page_icon="ğŸ—‘ï¸",
    layout="centered"
)

# ä¸»ç•Œé¢
st.title("ğŸ—‘ï¸ ä¸Šæµ·åƒåœ¾åˆ†ç±»å°åŠ©æ‰‹")
st.write("è¾“å…¥åƒåœ¾åç§°ï¼ŒæŸ¥è¯¢æ‰€å±åˆ†ç±»ï¼ˆ2023æœ€æ–°ç‰ˆï¼‰")

# æ¨¡ç³Šæœç´¢åŠŸèƒ½
def fuzzy_search(query, choices, limit=5):
    """è¿”å›æ¨¡ç³ŠåŒ¹é…çš„ç»“æœ"""
    results = process.extract(query, choices, limit=limit)
    return [result[0] for result in results if result[1] > 50]  # ç›¸ä¼¼åº¦å¤§äº50%

# æœç´¢æ¡†
search_query = st.text_input("è¯·è¾“å…¥åƒåœ¾åç§°", 
                           placeholder="ä¾‹å¦‚ï¼šç”µæ± ã€å¡‘æ–™è¢‹...",
                           key="search_input")

# å®æ—¶æ˜¾ç¤ºæ¨¡ç³ŠåŒ¹é…ç»“æœ
if search_query:
    matches = fuzzy_search(search_query, ALL_ITEMS)
    if matches:
        selected = st.selectbox("é€‰æ‹©ä½ æƒ³æŸ¥è¯¢çš„ç‰©å“ï¼š", 
                              [""] + matches,
                              format_func=lambda x: "è¯·é€‰æ‹©..." if x == "" else x)
        
        if selected:
            for category, items in TRASH_CLASSIFICATION.items():
                if selected in items:
                    st.success(f"ã€{selected}ã€å±äºï¼š{category}")
                    break
    else:
        st.warning("æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç‰©å“ï¼Œè¯·å°è¯•å…¶ä»–åç§°")

# åˆ†ç±»ç¤ºä¾‹å±•ç¤º
st.divider()
st.subheader("2023å¹´æœ€æ–°åƒåœ¾åˆ†ç±»æŒ‡å—")

tabs = st.tabs(["å¯å›æ”¶ç‰©", "æœ‰å®³åƒåœ¾", "æ¹¿åƒåœ¾", "å¹²åƒåœ¾"])
for i, (category, items) in enumerate(TRASH_CLASSIFICATION.items()):
    with tabs[i]:
        st.write(f"#### {category}ï¼ˆå…±{len(items)}ç§ï¼‰")
        cols = st.columns(3)
        for j, item in enumerate(items):
            cols[j%3].write(f"- {item}")

# é¡µè„š
st.divider()
st.caption("æ•°æ®æ ¹æ®ã€Šä¸Šæµ·å¸‚ç”Ÿæ´»åƒåœ¾ç®¡ç†æ¡ä¾‹ï¼ˆ2023ä¿®è®¢ç‰ˆï¼‰ã€‹æ•´ç†")
st.caption("æç¤ºï¼šä¸ç¡®å®šåˆ†ç±»æ—¶è¯·é€‰æ‹©å¹²åƒåœ¾")

# æ·»åŠ requirements.txtå†…å®¹è¯´æ˜
st.sidebar.info("""
**éƒ¨ç½²è¯´æ˜ï¼š**
1. éœ€è¦å®‰è£…ä¾èµ–ï¼š
